#! /data/Python_envs/Python3/bin/python3

from ncclient import manager
from lxml import etree

# NETCONF Connection Parameters
HOST = "172.20.0.20"
PORT = 830
USERNAME = "admin"
PASSWORD = "admin"

# NETCONF Filter to Retrieve the Hostname
HOSTNAME_FILTER = """
<filter>
    <native xmlns="http://cisco.com/ns/yang/Cisco-IOS-XE-native">
        <hostname/>
    </native>
</filter>
"""

# Create NETCONF Connection and Retrieve Hostname
try:
    with manager.connect(
        host=HOST,
        port=PORT,
        username=USERNAME,
        password=PASSWORD,
        device_params={"name": "csr"},
        hostkey_verify=False,
        look_for_keys=False,
        allow_agent=False,
    ) as router:

        # Retrieve the hostname details
        hostname_data = router.get_config(source="running", filter=HOSTNAME_FILTER)

        # Extract XML content as a string
        hostname_xml = hostname_data.data_xml  

        # Remove XML declaration if present
        hostname_xml = hostname_xml.encode("utf-8")  # Convert string to bytes

        # Parse and format XML output
        parsed_xml = etree.fromstring(hostname_xml)

        # Extract hostname value
        namespace = {"xe": "http://cisco.com/ns/yang/Cisco-IOS-XE-native"}
        hostname = parsed_xml.find(".//xe:hostname", namespaces=namespace)

        if hostname is not None:
            print(f"Router Hostname: {hostname.text}")
        else:
            print("Hostname not found!")

except Exception as e:
    print(f"Error: {e}")
