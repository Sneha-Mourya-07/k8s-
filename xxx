#!/data/Python_envs/Python3/bin/python3

from ncclient import manager
from lxml import etree

# NETCONF Connection Parameters
HOST = '172.20.0.20'
PORT = 830
USERNAME = 'admin'
PASSWORD = 'admin'

# NETCONF Filter to Retrieve Interface Details (Try `ietf-interfaces` first)
INTERFACE_FILTER = """
<filter>
    <interfaces xmlns="urn:ietf:params:xml:ns:yang:ietf-interfaces"/>
</filter>
"""

# Alternative: Cisco Native Interface Filter
CISCO_INTERFACE_FILTER = """
<filter>
    <native xmlns="http://cisco.com/ns/yang/Cisco-IOS-XE-native">
        <interface/>
    </native>
</filter>
"""

try:
    with manager.connect(
        host=HOST,
        port=PORT,
        username=USERNAME,
        password=PASSWORD,
        device_params={'name': 'csr'},
        hostkey_verify=False,  
        look_for_keys=False,  
        allow_agent=False     
    ) as router:

        # Retrieve the interface details
        try:
            interface_data = router.get_config(source='running', filter=INTERFACE_FILTER)
        except Exception:
            print("`ietf-interfaces` not supported, trying Cisco native model...")
            interface_data = router.get_config(source='running', filter=CISCO_INTERFACE_FILTER)

        # Convert XML response to readable format
        interface_xml = interface_data.data_xml.encode("utf-8")  # Convert string to bytes to avoid Unicode error

        # Print the configuration in formatted XML
        print("Interface Details:")
        print(etree.tostring(etree.fromstring(interface_xml), pretty_print=True).decode())

except Exception as e:
    print(f"Error: {e}")
